<!--

@license Apache-2.0

Copyright (c) 2018 The Stdlib Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->

# Lint

> Lint the [license header][@stdlib/_tools/licenses/header] for each file in a provided file list.

<section class="usage">

## Usage

```javascript
var lint = require( '@stdlib/_tools/lint/license-header-file-list' );
```

#### lint( files, \[header,] clbk )

Asynchronously lints the [license header][@stdlib/_tools/licenses/header] for each file in a provided file list.

```javascript
var files = [
    __filename
];

lint( files, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

By default, the linter lints against an Apache-2.0 [license header][@stdlib/_tools/licenses/header] tailored to common filename extensions. To lint against an alternative [license header][@stdlib/_tools/licenses/header] or list of filename extensions, provide a `header` argument, which may be a `string`, [regular expression][mdn-regexp], or an `object` whose keys are filename extensions and whose values are [license header][@stdlib/_tools/licenses/header] `strings` or [regular expressions][mdn-regexp]. For example, to lint against a particular [license header][@stdlib/_tools/licenses/header] `string`,

```javascript
var files = [
    __filename
];

var header = '// This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0';

lint( files, header, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

To lint against a license header [regular expression][mdn-regexp],

```javascript
var files = [
    __filename
];

var header = /\/\/ This file is a part of stdlib\. License is Apache-2\.0: http:\/\/www\.apache\.org\/licenses\/LICENSE-2\.0/;

lint( files, header, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

To lint against an `object` containing license header `strings` and/or [regular expressions][mdn-regexp],

```javascript
var files = [
    __filename
];

var header = {
    // JavaScript files:
    'js': '// This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0',

    // Julia files:
    'jl': '# This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0',

    // Markdown files:
    'md': '<!-- This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0 -->',

    // Everything else:
    'default': /\/\* This file is a part of stdlib\. License is Apache-2\.0: http:\/\/www\.apache\.org\/licenses\/LICENSE-2\.0 \*\//
};

lint( files, header, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

If a provided `header` object includes a `default` property, the value assigned to that property is used to lint **all** files having filename extensions **not** explicitly included in the object; otherwise, the function **ignores** any file **not** having a filename extension explicitly included in the object.

#### lint.sync( files\[, header] )

Synchronously lints the [license header][@stdlib/_tools/licenses/header] for each file in a provided file list.

```javascript
var files = [
    __filename
];

var errs = lint.sync( files );
// returns [...]
```

</section>

<!-- /.usage -->

<section class="notes">

## Notes

-   The linter considers the presence of more than one [license header][@stdlib/_tools/licenses/header] in a file a lint error.

-   [License headers][@stdlib/_tools/licenses/header] are expected to begin within the first **5** lines of a file. If a [license header][@stdlib/_tools/licenses/header] begins elsewhere in a file, the linter considers this a lint error.

-   If all files are valid, the returned result is an empty `array`.

-   Each failure is returned as an `object` with the following properties:

    -   **name**: filename.
    -   **error**: reason for failure.

    ```text
    {
        "name": "path/to/failing/file.abc",
        "error": "malformed or missing license header."
    }
    ```

-   Only files which fail are returned.

</section>

<!-- /.notes -->

<section class="examples">

## Examples

<!-- eslint no-undef: "error" -->

```javascript
var createTable = require( '@stdlib/_tools/licenses/header-regexp-table' );
var lint = require( '@stdlib/_tools/lint/license-header-file-list' );

// Create an object mapping filename extensions to license header regular expressions:
var headers = createTable( 'Apache-2.0', [ 'js', 'md' ] );

// Generate a list of files to lint:
var files = [
    __filename
];

// Lint files:
lint( files, headers, onLint );

function onLint( error, errs ) {
    if ( error ) {
        throw error;
    }
    console.error( JSON.stringify( errs ) );
}
```

</section>

<!-- /.examples -->

* * *

<section class="cli">

## CLI

<section class="usage">

### Usage

```text
Usage: lint-license-header-file-list [options] [<file> <file> ...]

Options:

  -h, --help             Print this message.
  -V, --version          Print the package version.
      --split sep        Separator used to split stdin data. Default: /\\r?\\n/.
      --header filepath  License header file path.
```

</section>

<!-- /.usage -->

<section class="notes">

### Notes

-   Files which fail are printed to `stderr` as newline-delimited JSON ([NDJSON][ndjson]).

-   To provide multiple [license headers][@stdlib/_tools/licenses/header], set multiple `--header` option arguments, where each argument value **must** include a file extension prefix. For example,

    <!-- run-disable -->

    ```bash
    $ lint-license-header-file-list --header='awk:./beep.txt' --header='js:./boop.txt' --header='default:./foo.txt' ./README.md
    ```

-   If the `split` separator is a [regular expression][mdn-regexp], ensure that the option is properly **escaped**.

    <!-- run-disable -->

    ```bash
    # Not escaped...
    $ <stdout> | lint-license-header-file-list --split /\r?\n/

    # Escaped...
    $ <stdout> | lint-license-header-file-list --split /\\r?\\n/
    ```

-   File paths may be relative or absolute file paths. Relative file paths are resolved relative to the current working directory of the calling process.

</section>

<!-- /.notes -->

<section class="examples">

### Examples

```bash
$ lint-license-header-file-list ./README.md
```

To use as part of a [standard stream][standard-stream] pipeline,

```bash
$ echo -n $'./README.md\t./examples/index.js\t' | lint-license-header-file-list --split /\\t/
```

</section>

<!-- /.examples -->

</section>

<!-- /.cli -->

<!-- Section for related `stdlib` packages. Do not manually edit this section, as it is automatically populated. -->

<section class="related">

</section>

<!-- /.related -->

<!-- Section for all links. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="links">

[ndjson]: http://ndjson.org/

[mdn-regexp]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions

[standard-stream]: https://en.wikipedia.org/wiki/Pipeline_%28Unix%29

[@stdlib/_tools/licenses/header]: https://github.com/stdlib-js/stdlib/tree/develop/lib/node_modules/%40stdlib/_tools/licenses/header

</section>

<!-- /.links -->
