<!--

@license Apache-2.0

Copyright (c) 2018 The Stdlib Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->

# Bundle

> Bundle a list of packages into a single file.

<!-- Section to include introductory text. Make sure to keep an empty line after the intro `section` element and another before the `/section` close. -->

<section class="intro">

</section>

<!-- /.intro -->

<!-- Package usage documentation. -->

<section class="usage">

## Usage

```javascript
var bundle = require( '@stdlib/_tools/bundle/pkg-list' );
```

#### bundle( pkgs, \[options,] clbk )

Bundles a list of packages into a single file.

```javascript
var pkgs = [
    '@stdlib/math/base/special/erf',
    '@stdlib/math/base/special/gamma'
];

var opts = {
    'bundler': 'browserify',
    'paths': [
        '/path/to/stdlib/packages'
    ]
};

bundle( pkgs, opts, clbk );

function clbk( error, bundle ) {
    if ( error ) {
        throw error;
    }
    console.log( bundle.toString() );
}
```

The function accepts the following `options`:

-   **namespace**: namespace format. Must be one of `tree`, `flat`, or `none`. Setting the option equal to `tree` indicates that the bundle should use a nested object namespace. A `flat` namespace uses the global project namespace, where each project package has a unique alias. A value of `none` indicates to forgo a namespace and require that each package be loaded independently. Default: `tree`.
-   **bundler**: bundler. Default: [`'browserify'`][browserify].

The function accepts the following `options` which are specific to [browserify][browserify]:

-   **standalone**: standalone [browserify][browserify] export name. Setting this option instructs the function to generate a UMD bundle with the supplied export name. The generated bundle will work with other module systems. If no module system is found, the export name is attached to the `window` global.
-   **exportName**: bundle export target. The target is the name used to load the bundle from the external environment. In contrast to a standalone UMD bundle, a require function is exposed as a global variable. Default: `@stdlib/stdlib`.
-   **requireName**: name of function exposed to support external loading of modules from a [browserify][browserify] bundle. Default: `require`.
-   **transforms**: an `array` of [browserify][browserify] transform modules and functions (including corresponding options) to be applied during bundling.
-   **plugins**: an `array` of [browserify][browserify] plugins (including corresponding options) to be applied during bundling.
-   **external**: an `array` of modules to omit when generating a bundle. Omitted modules are assumed to be present in a separate external bundle.
-   **paths**: an `array` of directory paths in which to search for modules referenced via non-relative paths. By default, the function searches the current working directory and the paths extracted from the `NODE_PATH` environment variable. In order to search specific directories (e.g., in non-project developer environments or in environments in which the `NODE_PATH` variable has **not** been set), **explicitly** set this option.

</section>

<!-- /.usage -->

<!-- Package usage notes. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="notes">

## Notes

-   Unless a package namespace has an alias in the global alias namespace (e.g., `@stdlib/datasets` => `datasets`), namespaces are **not** included in either `flat` or `tree` namespace bundles. If namespace packages were allowed in `flat` namespace bundles, `flat` namespace bundles would have mixed namespaces, which is not desired (e.g., possibility of having multiple ways to access the same bundle value). If namespace packages were allowed in `tree` namespace bundles, `tree` namespace bundles may attempt to override namespace properties which are read-only. If you want a namespace, provide a namespace only, no namespace children, and generate a `tree` namespace bundle. And if you only want certain children, then provide the children, but not the namespace. Providing both signals confusion.
-   If the bundler is [browserify][browserify] and the intent is to include the bundle within another bundle (e.g., via `require`), you may need to use a [browserify][browserify] plugin, such as [browserify-derequire][browserify-derequire], in order to rename `require` calls and thus preserve the ability of the embedded bundle to resolve its bundled modules. Otherwise, `require` calls may attempt to resolve modules from the wrong bundle.

</section>

<!-- /.notes -->

<!-- Package usage examples. -->

<section class="examples">

## Examples

<!-- eslint no-undef: "error" -->

```javascript
var pkgNames = require( '@stdlib/_tools/pkgs/names' );
var bundle = require( '@stdlib/_tools/bundle/pkg-list' );

var fopts = {
    'pattern': '**/assert/**/package.json',
    'ignore': [
        '**/_**/**' // ignore "private" packages
    ]
};
var bopts = {
    'namespace': 'tree',
    'exportName': '@stdlib'
};

pkgNames( fopts, onNames );

function onNames( error, names ) {
    if ( error ) {
        throw error;
    }
    bundle( names, bopts, onBundle );
}

function onBundle( error, bundle ) {
    if ( error ) {
        throw error;
    }
    console.log( bundle.toString() );
}
```

</section>

<!-- /.examples -->

<!-- Section for describing a command-line interface. -->

* * *

<section class="cli">

## CLI

<!-- CLI usage documentation. -->

<section class="usage">

### Usage

```text
Usage: bundle-pkg-list [options] [<pkg> <pkg> <pkg> ...]

Options:

  -h,    --help                Print this message.
  -V,    --version             Print the package version.
         --split sep           Separator for stdin data. Default: '/\r?\n/'.
         --namespace type      Type of namespace. Default: 'tree'.
         --bundler bundler     Bundler. Default: 'browserify'.

Browserify Options:

         --standalone name     Generate a UMD bundle with the supplied export
                               name. The generated bundle will work with other
                               module systems. If no module system is found, the
                               export name is attached to the `window` global.

         --export-name name    Bundle export target. The target is the name used
                               to load the bundle from the external environment.
                               In contrast to a standalone UMD bundle, a require
                               function is exposed as a global variable.
                               Default: '@stdlib/stdlib'.

         --require-name name   External `require` name to support requiring
                               packages within a browserify bundle from the
                               external environment. Default: 'require'.

  -t,    --transform module    Apply a transform when bundling. To apply
                               multiple transforms, set a --transform flag
                               for each transform.

  -p,    --plugin module       Register a plugin. To register multiple plugins,
                               set a --plugin flag for each plugin.

  -u,    --external module     Omit a module from an output bundle. Omitted
                               modules are assumed to be present in a separate
                               external bundle. To omit multiple modules, set an
                               --external flag for each module to omit.

         --path path           Directory paths in which to search for modules
                               referenced using non-relative paths. To specify
                               multiple directories, set a --path flag for each
                               directory to search.
```

</section>

<!-- /.usage -->

<!-- CLI usage notes. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="notes">

### Notes

-   If the split separator is a [regular expression][mdn-regexp], ensure that the `split` option is properly **escaped**.

    ```bash
    # Not escaped...
    $ echo -n $'tape\nvirtual-dom\n' | bundle-pkg-list --split /\r?\n/

    # Escaped...
    $ echo -n $'tape\nvirtual-dom\n' | bundle-pkg-list --split /\\r?\\n/
    ```

-   An output bundle is **not** minified or compressed.

</section>

<!-- /.notes -->

<!-- CLI usage examples. -->

<section class="examples">

### Examples

```bash
$ bundle-pkg-list '@stdlib/math/base/special/erf' '@stdlib/math/base/special/gamma' > ./bundle.js
```

```bash
$ echo -n $'@stdlib/math/base/special/erf\n@stdlib/math/base/special/gamma\n' | bundle-pkg-list --split /\\r?\\n/ > ./bundle.js
```

For compression/minification, pipe to a downstream utility.

```bash
$ bundle-pkg-list '@stdlib/math/base/special/erf' '@stdlib/math/base/special/gamma' | uglifyjs
```

</section>

<!-- /.examples -->

</section>

<!-- /.cli -->

<!-- Section to include cited references. If references are included, add a horizontal rule *before* the section. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="references">

</section>

<!-- /.references -->

<!-- Section for related `stdlib` packages. Do not manually edit this section, as it is automatically populated. -->

<section class="related">

</section>

<!-- /.related -->

<!-- Section for all links. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="links">

[browserify]: https://github.com/substack/node-browserify

[mdn-regexp]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions

[browserify-derequire]: https://github.com/rse/browserify-derequire

</section>

<!-- /.links -->
