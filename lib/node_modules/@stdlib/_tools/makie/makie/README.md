<!--

@license Apache-2.0

Copyright (c) 2018 The Stdlib Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->

# makie

> Execute project Makefile commands from anywhere in the project.

<section class="intro">

Typically, to execute project `Makefile` commands, you must be in the root project directory. While `make` supports specifying a directory from which to run a `Makefile`, this can be cumbersome, especially if a command expects configuration via environment variables.

This utility provides support for executing a subset of `Makefile` commands from anywhere within the project. The list of supported targets includes:

-   `repl`
-   `notes`
-   `examples`
-   `test`
-   `test-cov`
-   `test-summary`
-   `view-cov`
-   `benchmark`
-   `lint-javascript`
-   `lint-markdown`
-   `lint-python`
-   `lint-r`
-   `lint-typescript-declarations`
-   `complexity`
-   `list-pkgs`
-   `list-pkgs-names`
-   `stats-list-contributors`
-   `markdown-asset-link`
-   `install-node-addons`
-   `wasm`

When executing a command, the current working directory is used as a filter. Thus, when invoking the `test` command, **only** those tests in the current working directory and below will be run.

</section>

<!-- /.intro -->

<section class="usage">

## Usage

```javascript
var makie = require( '@stdlib/_tools/makie/makie' );
```

#### makie( dirpath, options, target )

Executes a Makefile command where the command is identified by a `target` and the Makefile containing the `target` is located in directory `dirpath`.

```javascript
var spawn = require( 'child_process' ).spawn;

function plugin( dirpath, cwd, subpath ) {
    var proc = spawn( 'make', [], 'test' );
}

var opts = {
    'plugins': {
        'test': plugin
    }
};

// Execute the `test` command:
makie( '/home/stdlib-js/stdlib', opts, 'test' );
```

The function accepts the following `options`:

-   **plugins**: an `object` whose keys correspond to Makefile targets and whose values are `functions` implementing the plugin interface.

### Plugins

Plugins are `functions` which execute a Makefile command.

#### plugin( dir, cwd, subpath )

Executes a Makefile target. A plugin is provided the following arguments:

-   **dir**: the Makefile directory provided above.
-   **cwd**: current working directory of the calling process.
-   **subpath**: subdirectory path, if `makie` is called in a subdirectory; otherwise, an empty `string`.

```javascript
var spawn = require( 'child_process' ).spawn;

function plugin( dir, cwd ) {
    var opts;
    var args;
    var proc;

    opts = {};
    opts.cwd = dir;
    opts.stdio = 'inherit';

    args = new Array( 2 );

    // Environment variables:
    args[ 0 ] = 'REPL_DIR='+cwd;

    // Target:
    args[ 1 ] = 'repl';

    proc = spawn( 'make', args, opts );
}
```

</section>

<!-- /.usage -->

* * *

<section class="cli">

## CLI

<!-- <installation> -->

## Installation

To install the command-line utility, add the following line to your `~/.bashrc` (Linux) or `~/.bash_profile` (Mac OS X), making sure to adjust the path based on your project setup.

```text
alias makie=/path/to/stdlib/tools/bin/makie
```

and then

```bash
$ chmod +x /path/to/stdlib/tools/bin/makie
```

<!-- </installation> -->

<section class="usage">

### Usage

```bash
Usage: makie [options] <target>

Options:

  -h,    --help                Print this message.
  -V,    --version             Print the package version.
         --dir dirpath         Makefile directory.
         --config path         Path to configuration file.
```

</section>

<!-- /.usage -->

<section class="examples">

### Examples

```bash
$ makie test-cov
<command_output>
```

</section>

<!-- /.examples -->

</section>

<!-- /.cli -->

<!-- Section for related `stdlib` packages. Do not manually edit this section, as it is automatically populated. -->

<section class="related">

</section>

<!-- /.related -->

<!-- Section for all links. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="links">

</section>

<!-- /.links -->
