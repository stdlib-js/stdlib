<!--

@license Apache-2.0

Copyright (c) 2018 The Stdlib Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->

# Update Header

> Update a [license header][@stdlib/_tools/licenses/header] in each file in a provided file list.

<section class="usage">

## Usage

```javascript
var updateHeader = require( '@stdlib/_tools/licenses/update-header-file-list' );
```

#### updateHeader( files, old, header, clbk )

Asynchronously [updates][@stdlib/_tools/licenses/update-header] a [license header][@stdlib/_tools/licenses/header] in each file in a provided file list.

<!-- run-disable -->

```javascript
var join = require( 'path' ).join;

var files = [
    join( __dirname, 'examples', 'index.js' )
];

var old = '// @license Apache-2.0';
var header = '// This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0';

updateHeader( files, old, header, done );

function done( error ) {
    if ( error ) {
        throw error;
    }
}
```

Both `old` and `header` arguments may be objects whose keys are filename extensions and whose values are [license header][@stdlib/_tools/licenses/header] `strings` and/or [regular expressions][mdn-regexp]. For example,

<!-- run-disable -->

```javascript
var join = require( 'path' ).join;

var files = [
    join( __dirname, 'README.md' ),
    join( __dirname, 'examples', 'index.js' )
];

var old = {
    // JavaScript files:
    'js': '// @license MIT',

    // Julia files:
    'jl': /# @license MIT/,

    // Markdown files:
    'md': '<!-- @license MIT -->',

    // Everything else:
    'default': /(?:#|\/\*|\/\/|<!--|!) @license MIT.*/
};

var header = {
    // JavaScript files:
    'js': '// This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0',

    // Julia files:
    'jl': /# This file is a part of stdlib\. License is Apache-2\.0: http:\/\/www\.apache\.org\/licenses\/LICENSE-2\.0/,

    // Markdown files:
    'md': '<!-- This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0 -->',

    // Everything else:
    'default': /(?:#|\/\*|\/\/|<!--|!) This file is a part of stdlib\. License is Apache-2\.0: http:\/\/www\.apache\.org\/licenses\/LICENSE-2\.0.*/
};

updateHeader( files, old, header, done );

function done( error ) {
    if ( error ) {
        throw error;
    }
}
```

If a provided header object includes a `default` property, the value assigned to that property is used to update [license headers][@stdlib/_tools/licenses/header] from **all** files having filename extensions **not** explicitly included in the object; otherwise, the function **ignores** any file **not** having a filename extension explicitly included in the object.

#### updateHeader.sync( files, old, header )

Synchronously [updates][@stdlib/_tools/licenses/update-header] a [license header][@stdlib/_tools/licenses/header] in each file in a provided file list.

<!-- run-disable -->

```javascript
var join = require( 'path' ).join;

var files = [
    join( __dirname, 'examples', 'index.js' )
];

var old = '// @license MIT';
var header = '// This file is a part of stdlib. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0';

var err = updateHeader.sync( files, old, header );
if ( err ) {
    throw err;
}
```

</section>

<!-- /.usage -->

<section class="notes">

## Notes

-   Input files are **overwritten**. If overwriting files is **not** desired, copy files to another location and provide the updated file paths.
-   File paths are resolved relative to the current working directory of the calling process.

</section>

<!-- /.notes -->

<section class="examples">

## Examples

<!-- eslint no-undef: "error" -->

```javascript
var join = require( 'path' ).join;
var readFile = require( '@stdlib/fs/read-file' ).sync;
var writeFile = require( '@stdlib/fs/write-file' ).sync;
var unlink = require( '@stdlib/fs/unlink' ).sync;
var headerRegExp = require( '@stdlib/_tools/licenses/header-regexp' );
var licenseHeader = require( '@stdlib/_tools/licenses/header' );
var updateHeader = require( '@stdlib/_tools/licenses/update-header-file-list' );

// Create a temporary file:
var src = join( __dirname, 'examples', 'fixtures', 'file.js.txt' );
var tmp = join( __dirname, 'examples', 'fixtures', 'tmp.js.txt' );
var err = writeFile( tmp, readFile( src ) );
if ( err ) {
    throw err;
}

// Specify a list of files in which to update headers:
var files = [
    tmp
];

// Generate a header regular expression:
var old = {
    'txt': headerRegExp( 'Apache-2.0', 'js' )
};

// Modify the regular expression to include an additional trailing newline:
old.txt = new RegExp( old.txt.source+'\n' );

// Generate a license header:
var header = {
    'txt': licenseHeader( 'Apache-2.0', 'js', {
        'year': 2018,
        'copyright': 'Jane Doe'
    })
};

// Update headers:
err = updateHeader.sync( files, old, header );
if ( err ) {
    throw err;
}

// Print the contents of the temporary file:
console.log( readFile( tmp, 'utf8' ) );

// Remove the temporary file:
err = unlink( tmp );
if ( err ) {
    throw err;
}
```

</section>

<!-- /.examples -->

* * *

<section class="cli">

## CLI

<section class="usage">

### Usage

```text
Usage: update-license-header-file-list [options] [<file> <file> ...]

Options:

  -h, --help             Print this message.
  -V, --version          Print the package version.
      --split sep        Separator used to split stdin data. Default: /\\r?\\n/.
      --old filepath     File path to license header to replace.
      --header filepath  File path to license header to insert.
```

</section>

<!-- /.usage -->

<section class="notes">

### Notes

-   To provide multiple [license headers][@stdlib/_tools/licenses/header], set multiple `--header`/`--old` option arguments, where each argument value **must** include a file extension prefix. For example,

    <!-- run-disable -->

    ```bash
    $ update-license-header-file-list --header='awk:./beep.txt' --header='js:./boop.txt' --header='default:./foo.txt' ./README.md
    ```

-   If the `split` separator is a [regular expression][mdn-regexp], ensure that the option value is properly **escaped**.

    <!-- run-disable -->

    ```bash
    # Not escaped...
    $ <stdout> | update-license-header-file-list --split /\r?\n/

    # Escaped...
    $ <stdout> | update-license-header-file-list --split /\\r?\\n/
    ```

-   File paths may be relative or absolute file paths. Relative file paths are resolved relative to the current working directory of the calling process.

</section>

<!-- /.notes -->

<section class="examples">

### Examples

<!-- run-disable -->

```bash
$ update-license-header-file-list ./examples/index.js
```

To use as part of a [standard stream][standard-stream] pipeline,

<!-- run-disable -->

```bash
$ echo -n $'./README.md\t./examples/index.js\t' | update-license-header-file-list --split /\\t/
```

</section>

<!-- /.examples -->

</section>

<!-- /.cli -->

<!-- Section for related `stdlib` packages. Do not manually edit this section, as it is automatically populated. -->

<section class="related">

</section>

<!-- /.related -->

<!-- Section for all links. Make sure to keep an empty line after the `section` element and another before the `/section` close. -->

<section class="links">

[mdn-regexp]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions

[standard-stream]: https://en.wikipedia.org/wiki/Pipeline_%28Unix%29

[@stdlib/_tools/licenses/header]: https://github.com/stdlib-js/stdlib/tree/develop/lib/node_modules/%40stdlib/_tools/licenses/header

[@stdlib/_tools/licenses/update-header]: https://github.com/stdlib-js/stdlib/tree/develop/lib/node_modules/%40stdlib/_tools/licenses/update-header

</section>

<!-- /.links -->
