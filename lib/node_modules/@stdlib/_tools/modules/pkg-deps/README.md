<!--

@license Apache-2.0

Copyright (c) 2018 The Stdlib Authors.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

-->

# Package Dependencies

> List package dependencies.

<section class="usage">

## Usage

```javascript
var pkgDeps = require( '@stdlib/_tools/modules/pkg-deps' );
```

<a name="pkg-deps"></a>

#### pkgDeps( file, \[options,] clbk )

Asynchronously lists package dependencies.

```javascript
pkgDeps( __filename, clbk );

function clbk( error, results ) {
    if ( error ) {
        throw error;
    }
    console.dir( results );
}
```

The first argument may be either a file path string (either relative or absolute) or an `array` of file paths. If provided a relative file path, the path is resolved relative to the current working directory.

```javascript
pkgDeps( [ __filename, __filename ], clbk );

function clbk( error, results ) {
    if ( error ) {
        throw error;
    }
    console.dir( results );
}
```

Each file is represented by an `object` having the following fields:

-   **file**: file name.
-   **deps**: an `array` of package dependencies.

The function accepts the following `options`:

-   **builtins**: `boolean` indicating whether to include built-in package dependencies. Default: `true`.
-   **walk**: `boolean` indicating whether to walk relative module dependencies. Default: `true`.
-   **aliases**: `object` mapping relative module dependency identifiers to other module identifiers (e.g., mapping non-browser-compatible modules to browser-compatible modules). When a module identifier resolves to the same path as an object key, the associated object value is substituted for the original identifier, and the function walks the substituted module in place of the original module. Relative module identifiers are resolved relative to the provided file paths.

By default, the function walks relative module dependencies to resolve both primary and secondary package dependencies. To only resolve a file's direct package dependencies, set the `walk` option to `false`.

```javascript
var opts = {
    'walk': false
};

pkgDeps( __filename, opts, clbk );

function clbk( error, results ) {
    if ( error ) {
        throw error;
    }
    console.dir( results );
}
```

#### pkgDeps.sync( file\[, options] )

Synchronously lists package dependencies.

```javascript
var results = pkgDeps.sync( __filename );
// returns [...]
```

The function accepts the same `options` as [`pkgDeps()`](#pkg-deps) above.

</section>

<!-- /.usage -->

<section class="examples">

## Examples

<!-- eslint no-undef: "error" -->

```javascript
var join = require( 'path' ).join;
var pkgDeps = require( '@stdlib/_tools/modules/pkg-deps' );

var file = join( __dirname, 'lib', 'index.js' );

pkgDeps( file, clbk );

function clbk( error, results ) {
    if ( error ) {
        throw error;
    }
    console.dir( results );
}
```

</section>

<!-- /.examples -->

* * *

<section class="cli">

## CLI

<section class="usage">

### Usage

```text
Usage: module-pkg-deps [options] [<file> <file> <file> ...]

Options:

  -h,    --help                Print this message.
  -V,    --version             Print the package version.
         --no-builtins         Do not include built-ins.
         --no-walk             Do not walk relative module dependencies.
         --split sep           Separator for standard input data. Default: '/\r?\n/'.
```

</section>

<!-- /.usage -->

<section class="notes">

### Notes

-   If the split separator is a [regular expression][mdn-regexp], ensure that the `split` option is properly **escaped**.

    ```bash
    # Not escaped...
    $ echo -n $'file1\nfile2\n' | module-pkg-deps --split /\r?\n/

    # Escaped...
    $ echo -n $'file1\nfile2\n' | module-pkg-deps --split /\\r?\\n/
    ```

-   Results are printed to `stdout` as newline-delimited JSON ([NDJSON][ndjson]).

</section>

<!-- /.notes -->

<section class="examples">

### Examples

```bash
$ module-pkg-deps /foo/bar/baz
{...}
```

```bash
$ echo -n $'/foo/bar/baz\n/beep/boop/bop\n' | module-pkg-deps --split /\\r?\\n/
{...}
{...}
```

</section>

<!-- /.examples -->

</section>

<!-- /.cli -->

<section class="links">

[mdn-regexp]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions

[ndjson]: http://ndjson.org/

</section>

<!-- /.links -->
