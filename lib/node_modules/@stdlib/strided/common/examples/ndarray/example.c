/**
* @license Apache-2.0
*
* Copyright (c) 2018 The Stdlib Authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*    http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

#include <stdlib.h>
#include <stdio.h>
#include <stdint.h>
#include "stdlib/ndarray_bytes_per_element.h"
#include "stdlib/ndarray_dtypes.h"
#include "stdlib/ndarray_orders.h"
#include "stdlib/ndarray.h"
#include "stdlib/strided_dtypes.h"

int main() {
	// Manually create an ndarray...
	struct ndarray *x = malloc( sizeof( struct ndarray ) );
	if ( x == NULL ) {
		printf( "Error allocating memory.\n" );
		exit( 1 );
	}

	// Create an underlying byte array:
	uint8_t buffer[] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
	x->data = buffer;

	// Specify the underlying data type:
	enum STDLIB_NDARRAY_DTYPE dtype = STDLIB_NDARRAY_FLOAT64;
	x->dtype = dtype;

	// Explicitly specify the number of bytes per element:
	enum STDLIB_NDARRAY_BYTES_PER_ELEMENT nbytes = STDLIB_NDARRAY_FLOAT64_BYTES_PER_ELEMENT;
	x->BYTES_PER_ELEMENT = nbytes;

	// Specify the array shape:
	int64_t shape[] = { 3 }; // vector consisting of 3 doubles
	x->shape = shape;

	// Specify the array strides:
	int64_t strides[] = { x->BYTES_PER_ELEMENT };
	x->strides = strides;

	// Specify the byte offset:
	x->offset = 0;

	// Specify the array order (note: this does not matter for a 1-dimensional array):
	enum STDLIB_NDARRAY_ORDER order = STDLIB_NDARRAY_ROW_MAJOR;
	x->order = order;

	// Explicitly specify the number of array dimensions:
	x->ndims = 1; // vector

	// Explicitly specify the number of array elements (doubles):
	x->length = x->shape[ 0 ];

	// Explicitly specify the number of bytes:
	x->byteLength = (x->length) * (x->BYTES_PER_ELEMENT);

	// Set the one-letter abbreviation:
	enum STDLIB_STRIDED_DTYPE_CHAR ltr = STDLIB_STRIDED_FLOAT64_CHAR;
	x->ltr = ltr;

	printf( "dtype = %u\n", x->dtype );
	printf( "length = %lld\n", x->length );
	printf( "byteLength = %lld\n", x->byteLength );
	printf( "ltr = %u\n", x->ltr );

	// Use the function interface to create an ndarray...
	struct ndarray *x2 = ndarray_constructor( buffer, 1, shape, strides, 0, order, dtype );
	if ( x2 == NULL ) {
		printf( "Error allocating memory.\n" );
		exit( 1 );
	}

	printf( "dtype = %u\n", x2->dtype );
	printf( "length = %lld\n", x2->length );
	printf( "byteLength = %lld\n", x2->byteLength );
	printf( "ltr = %u\n", x2->ltr );
}
